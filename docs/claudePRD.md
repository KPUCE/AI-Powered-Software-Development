# APNEA SENTINEL
## Product Requirement Document (PRD)

**Version:** 1.0  
**Date:** 2025-10-26  
**Document Owner:** Product Team  
**Target Platform:** iOS (iPhone, Apple Watch Ultra 2)

---

## 1. 문서 개요

### 1.1 목적
본 문서는 프리다이버 전용 올인원 플랫폼 "Apnea Sentinel"의 제품 요구사항을 정의합니다. 개발팀, 디자인팀, QA팀이 제품 개발 시 참조할 상세 기능 명세와 제약사항을 포함합니다.

### 1.2 범위
- **포함**: Apple Watch Ultra 2 및 iPhone 앱의 모든 기능적/비기능적 요구사항
- **제외**: Android 플랫폼, 백엔드 API 상세 설계, 인프라 아키텍처

### 1.3 대상 독자
- 제품 관리자
- iOS 개발자 (Swift/SwiftUI)
- WatchOS 개발자
- UI/UX 디자이너
- QA 엔지니어

---

## 2. 제품 개요

### 2.1 제품 비전
프리다이버의 생명을 보호하고 퍼포먼스를 향상시키는 AI 기반 안전 코파일럿

### 2.2 핵심 가치 제안
1. **안전**: AI 기반 블랙아웃 조기 경보 시스템
2. **통합**: 훈련-다이빙-분석-커뮤니티 올인원
3. **전문성**: 프리다이버만을 위한 특화 설계
4. **연결**: 실시간 버디 안전망

### 2.3 사용자 페르소나

**페르소나 1: 초급 프리다이버 "민지" (25세)**
- 인증: AIDA 2급 취득 3개월
- 목표: 안전하게 20m 달성
- 니즈: 체계적 훈련 가이드, 안전 경보
- 사용 빈도: 주 1-2회 다이빙

**페르소나 2: 중급 프리다이버 "현우" (32세)**
- 인증: AIDA 3급, 3년 경력
- 목표: 35m 돌파, 대회 준비
- 니즈: 세밀한 데이터 분석, 훈련 최적화
- 사용 빈도: 주 3-4회 다이빙 + 일일 훈련

**페르소나 3: 인스트럭터 "지영" (38세)**
- 인증: AIDA 강사, 10년 경력
- 목표: 학생 관리, 그룹 안전 확보
- 니즈: 학생 진행도 추적, 그룹 세션 관리
- 사용 빈도: 주 5-6일, 다중 세션

---

## 3. 기능적 요구사항 (Functional Requirements)

### 3.1 Apple Watch Ultra 2 기능

#### FR-W1: 실시간 다이빙 모니터링
**우선순위: P0 (Critical)**

**FR-W1.1 깊이 측정**
- MUST: 0.1m 단위로 실시간 깊이 표시 (최대 40m)
- MUST: 화면 중앙 초대형 폰트 (120pt 이상)
- MUST: 음수 깊이 방지 (수면 = 0.0m)
- SHOULD: 수면 기준점 자동 보정 (기압 변화 고려)

**FR-W1.2 다이빙 시간 측정**
- MUST: 수심 1.5m 이상 진입 시 자동 시작
- MUST: MM:SS 형식 표시
- MUST: 수면 복귀 시 자동 정지
- MUST: 백그라운드에서도 계속 측정

**FR-W1.3 심박수 모니터링**
- MUST: 초당 1회 심박수 측정 및 표시
- MUST: 수중에서도 정확도 유지 (±5 bpm)
- SHOULD: 심박수 추세 표시 (↑↓→)
- MUST: 측정 실패 시 "---" 표시

**FR-W1.4 수온 표시**
- MUST: 0.5°C 단위 실시간 표시
- SHOULD: 수온 급변 시 알림 (±3°C 이상)
- MUST: 섭씨/화씨 단위 전환 가능

**FR-W1.5 실시간 프로파일 그래프**
- MUST: 화면 하단 미니 그래프 (최근 3분)
- MUST: 깊이-시간 곡선 표시
- SHOULD: 목표 라인 오버레이
- NICE: 색상 코딩 (안전/주의/위험)

#### FR-W2: 블랙아웃 위험 경보 시스템
**우선순위: P0 (Critical)**

**FR-W2.1 안전도 계산**
- MUST: 개인 안전 한계 대비 현재 위치 실시간 계산
- MUST: 다음 요소 반영:
  - 현재 깊이 및 체류 시간
  - 과거 개인 베스트 기록 (최근 30일)
  - 금일 다이빙 누적 피로도
  - 수면 간격 준수율
- MUST: 0-100% 안전도 스코어 계산
- MUST: 매 5초마다 재계산

**FR-W2.2 단계별 경보**
- MUST: 70% 도달 시:
  - 진동 1회 (짧게, 100ms)
  - 화면 테두리 노란색
  - "주의" 텍스트 표시 (3초간)
- MUST: 85% 도달 시:
  - 진동 2회 (중간, 200ms x2)
  - 화면 테두리 주황색
  - "경고: 상승 고려" 텍스트 표시 (5초간)
- MUST: 95% 도달 시:
  - 진동 3회 (강하게, 300ms x3)
  - 화면 전체 빨간색 테두리
  - "위험: 즉시 상승" 텍스트 계속 표시
  - 매 10초마다 반복 경보

**FR-W2.3 심박수 기반 이상 감지**
- MUST: 다음 조건 시 즉시 경보:
  - 심박수 < (안정시 심박수 × 0.5)
  - 심박수 > (안정시 심박수 × 1.5)
  - 심박수 변화율 > 20 bpm/10초
  - 심박수 불규칙 (표준편차 > 15)
- MUST: 경보 시 "심박수 이상" 메시지 표시
- SHOULD: 버디에게 자동 알림 전송

#### FR-W3: 상승 속도 모니터링
**우선순위: P0 (Critical)**

**FR-W3.1 속도 계산**
- MUST: 3초 이동 평균으로 상승 속도 계산
- MUST: m/s 단위로 표시
- MUST: 하강 시에는 표시 안 함
- MUST: 수면 5m 이내에서만 활성화

**FR-W3.2 깊이별 위험 구간**
- MUST: 깊이에 따른 화면 색상 변경:
  - 15m+: 흰색 (일반)
  - 10-15m: 노란색 (주의)
  - 5-10m: 주황색 (경고)
  - 0-5m: 빨간색 (최고 위험)
- MUST: "Critical Zone" 텍스트 표시 (10m 이하)

**FR-W3.3 속도 피드백**
- MUST: 상승 속도에 따른 메시지:
  - 0-0.8 m/s: "Good pace" (녹색)
  - 0.8-1.2 m/s: "Slow down" (노란색) + 진동 1회
  - 1.2+ m/s: "TOO FAST" (빨간색) + 연속 진동
- MUST: 메시지는 5초간 표시

#### FR-W4: 수면 간격 타이머
**우선순위: P0 (Critical)**

**FR-W4.1 강제 회복 모니터링 (30초)**
- MUST: 수면 복귀 자동 감지 (0.5m 이하 5초 지속)
- MUST: 30초간 화면 자동 잠금 해제
- MUST: 표시 정보:
  - "Recovery Mode" 제목
  - 경과 시간 (00:00 / 00:30)
  - 실시간 심박수
  - 심박수 하강 추세 (↓)
  - 상태 메시지 ("정상 회복 중")
- MUST: "Breathe" 애니메이션 (확대/축소 동그라미)
- MUST: 비정상 회복 감지:
  - 심박수가 30초 후에도 > 120 bpm
  - 심박수가 오히려 상승
  → "버디 확인 필요" 경고 + 강한 진동

**FR-W4.2 권장 수면 간격 계산**
- MUST: 기본 공식: 다이빙 시간 × 2
- MUST: 가중치 적용:
  - 30m 이상 다이빙: × 2.5
  - 연속 4회 이상: × 3
  - 안전도 95% 도달 이력: × 3
- MUST: 최소 수면 간격: 다이빙 시간 × 2 (절대 하한)
- SHOULD: 개인 회복 속도 학습 (10회 다이빙 후)

**FR-W4.3 타이머 표시**
- MUST: 표시 정보:
  - "Surface Interval" 제목
  - 경과 시간 / 권장 시간 (02:34 / 04:30)
  - 회복도 % (실시간 계산)
  - 현재 심박수 및 추세
  - 연속 다이빙 횟수 (3/5)
- MUST: 권장 시간 도달 시:
  - 진동 2회
  - "다음 다이빙 준비됨" 메시지
  - 녹색 체크마크 표시
- SHOULD: 강제 수면 간격 설정 (타이머 미달성 시 다이빙 시작 불가)

#### FR-W5: 긴급 SOS
**우선순위: P0 (Critical)**

**FR-W5.1 수동 SOS**
- MUST: Action Button 3초 홀드로 발동
- MUST: 발동 시:
  - "SOS 활성화됨" 전체 화면 표시
  - 화면 빨간색 깜빡임 (1초 간격)
  - 최대 강도 진동 연속 (5초)
  - GPS 좌표 즉시 기록
  - 버디 앱으로 위치 전송 (블루투스/인터넷)
  - iPhone으로 긴급 알림 전송
- MUST: 취소 버튼 표시 (오발동 방지)
- MUST: SOS 히스토리 자동 기록

**FR-W5.2 자동 위험 감지**
- MUST: 다음 조건 시 자동 SOS 준비:
  - 3분 이상 잠수 + 가속도계 움직임 없음 (10초)
  - 수면 복귀 후 10초간 움직임 없음
  - 심박수 < 35 bpm (10초 지속)
  - 심박수 측정 불가 (수중 30초)
- MUST: SOS 준비 모드:
  - "SOS 준비됨" 메시지 표시
  - 화면 주황색 테두리
  - 진동 3회
  - 10초 내 반응 없으면 자동 SOS 발동
- MUST: 반응 확인 방법:
  - 화면 터치
  - Digital Crown 회전
  - 버튼 누르기

**FR-W5.3 긴급 연락처 표시**
- MUST: SOS 발동 시 다음 정보 표시:
  - 현재 GPS 좌표 (복사 가능)
  - 사전 등록한 긴급 연락처 (최대 3개)
  - 해안 경비대 번호 (지역별)
  - "긴급 통화" 버튼 (iPhone 연결)
- SHOULD: 다이브 사이트 정보 (사전 등록 시)

#### FR-W6: 목표 깊이 알림
**우선순위: P1 (High)**

**FR-W6.1 목표 설정**
- MUST: Digital Crown으로 1m 단위 조절 (5-40m)
- MUST: 다이빙 시작 전 설정 화면 표시
- SHOULD: iPhone 앱에서 설정 후 동기화
- SHOULD: 최근 3회 평균 깊이 기본값 제안

**FR-W6.2 진행도 표시**
- MUST: 화면 상단 진행 바 (0-100%)
- MUST: 남은 거리 표시 ("6.5m left")
- SHOULD: 예상 도달 시간 (현재 속도 기반)

**FR-W6.3 알림**
- MUST: 목표 10m 전방:
  - 진동 1회 (가볍게)
  - "목표 근접" 메시지 (3초)
- MUST: 목표 도달:
  - 진동 3회 (중간 강도)
  - "목표 도달! 터닝하세요" 메시지 (계속)
  - 화면 녹색 테두리
- MUST: 목표 초과:
  - 진동 2회 (경고)
  - "목표 초과 +2.5m" 메시지
  - 안전도에 따라 색상 변경

**FR-W6.4 개인 신기록 감지**
- MUST: 개인 베스트 초과 시:
  - 특별 진동 패턴 (톡---톡---톡)
  - "🏆 신기록!" 메시지
  - 수면 복귀 후 축하 화면

#### FR-W7: 호흡 준비 가이드
**우선순위: P1 (High)**

**FR-W7.1 준비 모드 시작**
- MUST: 다이빙 시작 전 "호흡 준비" 버튼
- MUST: 기본 시간: 2분 (30초~5분 조절 가능)
- MUST: 백그라운드 음악 재생 옵션 (명상 음악)

**FR-W7.2 시각 가이드**
- MUST: 화면 중앙 동그라미 애니메이션:
  - 4초 확대 (들이쉬기)
  - 4초 축소 (내쉬기)
  - 커스텀 리듬 설정 가능 (3-7초)
- MUST: 현재 단계 텍스트 ("들이쉬기..." / "내쉬기...")
- SHOULD: 색상 변화 (들이쉬기: 파란색 → 내쉬기: 녹색)

**FR-W7.3 진동 가이드**
- MUST: 들이쉬기 시작 시 진동 1회 (짧게)
- SHOULD: 중간 지점 진동 (선택 옵션)
- MUST: 내쉬기 시작 시 진동 1회 (짧게)

**FR-W7.4 바이오피드백**
- MUST: 실시간 심박수 표시
- MUST: 목표 심박수 표시 (기본: 65 bpm)
- MUST: 목표 도달 시 녹색 체크마크
- SHOULD: 심박수 하강 추세 그래프

**FR-W7.5 완료**
- MUST: 목표 심박수 도달 OR 시간 종료 시:
  - "준비 완료" 메시지
  - 진동 3회
  - "다이빙 시작" 버튼 활성화
- SHOULD: 준비도 점수 (0-100)

#### FR-W8: 다이빙 단계 자동 인식
**우선순위: P2 (Medium)**

**FR-W8.1 단계 정의**
- MUST: 4단계 자동 구분:
  1. Descent (하강): 0-15m, 깊이 증가 중
  2. Freefall (자유낙하): 15m+, 가속도계 움직임 최소
  3. Turn (터닝): 최대 깊이 도달 후 3초
  4. Ascent (상승): 깊이 감소 중

**FR-W8.2 단계별 표시**
- MUST: 화면 좌측 상단 아이콘:
  - ↓ Descent (흰색)
  - ⇣ Freefall (파란색)
  - ⟲ Turn (노란색)
  - ↑ Ascent (녹색/주황/빨강)
- SHOULD: 단계명 텍스트 (3초간)

**FR-W8.3 단계별 피드백**
- SHOULD: Descent 단계:
  - 핀킥 횟수 추정 (가속도계)
  - "효율적" / "과도한 에너지 소비" 메시지
- SHOULD: Freefall 단계:
  - "완전 이완 유지" 메시지
  - 목표 심박수 범위: 40-50 bpm
- MUST: Turn 단계:
  - 체류 시간 카운터 (1, 2, 3초)
  - 3초 초과 시 "상승 시작" 알림
- MUST: Ascent 단계:
  - 상승 속도 경고 (FR-W3 연동)
  - Critical Zone 강조

#### FR-W9: 버디 실시간 연동
**우선순위: P2 (Medium)**

**FR-W9.1 버디 페어링**
- MUST: 블루투스로 버디 Watch와 연결
- MUST: 페어링 화면에서 근처 디바이스 스캔
- MUST: 버디 이름 표시 후 연결 요청
- MUST: 연결 상태 표시 (아이콘: 🔗 / ⚠️ 연결 끊김)
- SHOULD: 최대 3명까지 동시 연결

**FR-W9.2 데이터 공유**
- MUST: 실시간 공유 (1초 간격):
  - 현재 깊이
  - 다이빙 시간
  - 심박수
  - 안전 상태 (정상/주의/경고/위험)
- MUST: 데이터 암호화 전송
- MUST: 배터리 소모 최소화 (저전력 블루투스)

**FR-W9.3 버디 상태 표시**
- MUST: 화면 우측 상단 미니 위젯:
  - 버디 이름 (3글자 약어)
  - 깊이 (15.2m)
  - 상태 아이콘 (✓ / ⚠️ / 🚨)
- MUST: 터치 시 상세 정보:
  - 전체 이름
  - 다이빙 시간
  - 심박수
  - 현재 단계
- SHOULD: 여러 버디 시 스와이프로 전환

**FR-W9.4 버디 알림**
- MUST: 다음 상황 시 알림 (진동 + 메시지):
  - 버디가 목표 깊이 도달
  - 버디가 위험 상태 진입 (안전도 85%+)
  - 버디가 수면 복귀
  - 버디 연결 끊김
- MUST: 버디 긴급 상황 시:
  - "버디 위험! 확인 필요" 전체 화면 경고
  - 강한 연속 진동 (5초)
  - 화면 빨간색 깜빡임

#### FR-W10: 간단한 설정
**우선순위: P1 (High)**

**FR-W10.1 다이빙 모드 전환**
- MUST: 4가지 모드:
  1. 일반 모드: 모든 정보 표시
  2. 스텔스 모드: 화면 90% 어두움, 깊이만 표시
  3. 훈련 모드: 목표 vs 실제 강조
  4. 안전 우선 모드: 경보 민감도 최대
- MUST: 다이빙 시작 전 모드 선택 화면
- MUST: 다이빙 중 Digital Crown 길게 눌러 전환
- MUST: 선택한 모드 저장 (다음 다이빙에도 적용)

**FR-W10.2 알람 강도 조절**
- MUST: 3단계:
  - 약함: 진동 50% 강도
  - 보통 (기본): 진동 100% 강도
  - 강함: 진동 150% 강도, 알람 빈도 2배
- MUST: 설정 화면에서 테스트 진동 제공

**FR-W10.3 단위 설정**
- MUST: 미터/피트 전환
- MUST: 섭씨/화씨 전환
- MUST: Watch 설정과 동기화

#### FR-W11: 다이빙 완료 즉시 요약
**우선순위: P1 (High)**

**FR-W11.1 자동 요약 화면**
- MUST: 수면 복귀 + 30초 회복 모니터링 완료 후 자동 표시
- MUST: 표시 정보:
  - "Dive #5 Complete ✓" 제목
  - 최대 깊이: 28.4m
  - 다이빙 시간: 2:18
  - 평균/최저 심박수: 68 / 48 bpm
  - 회복 상태: "Good 👍" (심박수 회복 속도 기반)
- SHOULD: 간단한 평가:
  - 하강: "효율적 ✓"
  - 상승: "약간 빠름 ⚠️"
  - 전체: "A-"

**FR-W11.2 개인 기록 하이라이트**
- MUST: 신기록 달성 시:
  - 🏆 아이콘 + "신기록!" 메시지
  - 이전 기록 대비 차이 표시 (+2.1m)
  - 축하 애니메이션 (별 반짝임)
- SHOULD: 기간별 기록:
  - "이번 주 최고 기록"
  - "이번 달 최고 기록"

**FR-W11.3 다음 단계 안내**
- MUST: "iPhone에서 상세 보기" 버튼
- MUST: 권장 수면 간격 표시 ("Next dive ready in: 04:30")
- SHOULD: 간단한 피드백: "오늘 3/5 다이빙 완료"

#### FR-W12: 화면 레이아웃
**우선순위: P0 (Critical)**

**FR-W12.1 일반 모드 레이아웃**
```
┌─────────────────────────────┐
│ ↓ [15.2m] 👤Alex 🔗        │ ← 상단 바 (단계, 버디)
│                             │
│         18.4m               │ ← 깊이 (초대형, 120pt)
│    ━━━━━━━●━━━━━━          │ ← 목표 진행 바
│       [01:42]               │ ← 다이빙 시간 (60pt)
│   ❤️ 54  🌡️ 24°C          │ ← 심박수, 수온 (40pt)
│  🔋 ████░░░ 73%             │ ← 에너지 (선택 옵션)
│  Target: 25m / 6.6m left    │ ← 목표 정보 (30pt)
│  ━━━━━━━━━━━━━━━━━━━━━    │ ← 프로파일 그래프
└─────────────────────────────┘
```

**FR-W12.2 스텔스 모드 레이아웃**
```
┌─────────────────────────────┐
│                             │
│                             │
│         18.4m               │ ← 깊이만 표시
│                             │
│                             │
└─────────────────────────────┘
- 화면 밝기 10%
- 터치 시 3초간 전체 정보 표시
```

**FR-W12.3 색상 시스템**
- MUST: 안전 상태 색상:
  - 녹색: 0-70% (안전)
  - 노란색: 70-85% (주의)
  - 주황색: 85-95% (경고)
  - 빨간색: 95-100% (위험)
- MUST: 색상은 화면 테두리 및 주요 텍스트에 적용
- MUST: 색맹 모드 지원 (아이콘 병행 사용)

**FR-W12.4 터치 제스처**
- MUST: 화면 터치: 3초간 밝기 100% (스텔스 모드)
- MUST: 스와이프 좌/우: 버디 전환
- MUST: 스와이프 상/하: 정보 화면 전환 (프로파일 / 통계)
- SHOULD: Digital Crown 회전: 목표 깊이 빠른 조절

### 3.2 iPhone 앱 기능

#### FR-I1: 다이빙 로그북
**우선순위: P0 (Critical)**

**FR-I1.1 로그 목록**
- MUST: 시간순 정렬 (최신순 기본)
- MUST: 각 로그 카드 표시:
  - 날짜 및 시간
  - 다이브 사이트 이름 (입력 시)
  - 최대 깊이 / 다이빙 시간
  - 썸네일 사진 (첨부 시)
  - 태그 (예: "신
